---
path: '/campaign-development/advanced-use-case-apis/web-surveys'
title: 'Web Surveys'
attachments:
 - './SampleSurveyTemplate.zip'
tags: ['smart', 'api', 'smart api', 'smarts', 'surveys', 'web surveys']
---

### Overview

Interaction Studio Surveys uses the power of [SurveyJS](https://surveyjs.io/) to render surveys.

---

### Getting Started

1. Surveys is available to all Premium edition customers. If your account was provisioned prior to 4/7/2021, you will need to request a Gears refresh for your account from support in order for the Surveys Gear to show up in your Gears list and for the feature functionality to be fully enabled. If you are unsure if a Gears refresh has occurred, please reach out to your account admin who will be able to view the Gears list on your account. If a refresh occurred, they will see the Surveys Gear in the list as enabled.
2. Create at least one survey in the Surveys editor, which can be found in the IS Dashboard.

Once the above has been done, you will now be able to use the Surveys system in Templates.

For more information on creating a survey, see [Create or Edit a Survey](https://doc.evergage.com/display/EKB/Create+or+Edit+a+Survey).

<br>

### Third Party Library
[SurveyJS](https://surveyjs.io/)
- version: 1.0.95
- sizes: JS(compressed) - 149 kB, CSS(compressed) - 4.0 kB

This version of SurveyJS is a variant of the jQuery version updated to use the [Cash](https://kenwheeler.github.io/cash/#docs) library that is included in the Interaction Studio WebSDK. However, this means that there may be unsupported features, such as SurveyJS's custom widgets.

<br>

### API
#### Methods
```ts
renderSurvey(survey: Survey, renderTarget: Element): Promise<void>
```
- Injects the SurveyJS library, renders survey, and handles responses when completed.
- `Survey` should have the following shape:
```ts
    interface Survey {
        id: string,
        name: string,
        config: SurveyConfig // references SurveyJS's JSON object
    }
```

```ts
injectSurveyResourcesIntoPage(): Promise<void>
```
- Use this if you want custom integration such as custom themes.

---

#### Using the Surveys Gear

1. Invoking `renderSurvey` will automatically use `injectSurveyResourcesIntoPage` to inject the SurveyJS library from the Interaction Studio CDN on pageload. Please note that this doesn't apply to client-side page changes, such as those in a [SPA](https://developer.mozilla.org/en-US/docs/Glossary/SPA).
2. Once the SurveyJS library instance is detected, it will start to render the survey.
3. When each page of the survey is "completed" or "submitted", it will parse through survey config and send an event with each response stored as a survey attribute.

<br>

### Storing Responses on the User Profile

Surveys attributes are automatically set up upon survey creation. These attributes can be viewed in the Interaction Studio platform under Settings > Attributes > Survey Attributes. The attributes become visible on the individual User profile only after a survey event in the specified format is received (see [Sending a Survey Event](#sending-a-survey-event)). Once the survey event is received by Interaction Studio, the responses are stored within the corresponding Surveys attributes. The event requires `surveyId`, `surveyStartTime`, and all the Surveys attributes representing a user's responses to questions in the survey.

Each Surveys attribute will be stored in the below format:

`survey:<surveyId>:<questionId>:<rowId>` or `survey:<surveyId>:<questionId>`

`<surveyId>` and `<questionId>` are generated by Interaction Studio. `<rowId>` is used for Matrix questions, but is otherwise omitted.

By default, there is a limit of 10 Surveys attributes.

#### Sending a Survey Event

The Surveys Gear automatically handles survey submissions and sends the survey event in the required format. As a developer, it is not necessary to include any code that sends a survey event within the Template.

The following example shows how to track a survey event in case the need to bypass the built-in tracking should arise.

Please note that it is *not recommended* to track a Surveys event outside of the Surveys Gear.

```js
Evergage.sendEvent({
    source: {
        surveyId: "string"
        surveyStartTime: "string"
    },
    user: {
        attributes: {
            "survey:<surveyId>:<questionId>:<rowId>": "string"
        }
    }
})
```

<br>

### Styling Surveys

There are a few different options available for styling surveys, many of which can be found in the SurveyJS documentation, such as for using [Custom CSS](https://surveyjs.io/Examples/Library/?id=survey-customcss&platform=jQuery&theme=bootstrap#content-js) and creating a [Custom Theme](https://surveyjs.io/Examples/Library/?id=custom-theme&platform=jQuery&theme=bootstrap#content-js).

Below is an example for applying custom styling with client-side JavaScript using the `applyTheme` function:
```js
function apply(context, template) {
    const contentZoneSelector = Evergage.getContentZoneSelector(context.contentZone);

    return Evergage.DisplayUtils
        .bind(buildBindId(context))
        .pageElementLoaded(contentZoneSelector)
        .then(element => {
            const $survey = Evergage.cashDom(template(context).trim());

            return Evergage.Surveys.injectSurveyResourcesIntoPage().then(()=>{
                Survey.StylesManager.applyTheme("default");
                return Evergage.Surveys.renderSurvey(context.survey, $survey).then(() => {
                    Evergage.cashDom(element).append($survey);
                });
            });
        });
}

```

<br>

### Stats Tracking
If using the example template below in a Campaign, an impression stat will automatically be tracked when the initial page of the survey is rendered. To track any other additional stats, please see [Campaign Stats Tracking](/campaign-development/web-templates/web-campaign-stats) for information about how to do so.

### Sample Template

<a href="./SampleSurveyTemplate.zip" download="SampleSurveyTemplate.zip">Sample Survey Template(zip)</a>

<details>
<summary>Handlebars HTML</summary>
<p>

```html
{{!--
    Template: Sample Survey Template

    Requirements:
    1) Surveys are available to all Premium edition customers. If your account was provisioned prior to 4/7/2021, you
        will need to request a gears refresh for your account from support in order for the Survey gear to show up in
        your gears list and for the feature functionality to be fully enabled.
    2) Create at least one Survey in the Survey editor, which can be found in the IS Dashboard.

--}}

<div id="evg-surveys" data-evg-campaign-id="{{campaign}}" data-evg-experience-id="{{experience}}"
    data-evg-user-group="{{userGroup}}" aria-label="Survey{{#if survey}} - {{survey.name}}{{/if}}">
</div>

```

</p>
</details>

<br>

<details>
<summary>CSS</summary>
<p>

```css
/* Default Theme */

```

</p>
</details>

<br>

<details>
<summary>Client-side JavaScript</summary>
<p>

```js
(function() {

    /**
     * @function buildBindId
     * @param {Object} context
     * @description Create unique bind ID based on the campaign and experience IDs.
     */
    function buildBindId(context) {
        return `${context.campaign}:${context.experience}`;
    }

    function apply(context, template) {
        const contentZoneSelector = Evergage.getContentZoneSelector(context.contentZone);

        return Evergage.DisplayUtils
            .bind(buildBindId(context))
            .pageElementLoaded(contentZoneSelector)
            .then((element) => {
                const $survey = Evergage.cashDom(template(context).trim());

                return Evergage.Surveys.renderSurvey(context.survey, $survey).then(() => {
                    Evergage.cashDom(element).append($survey);
                });
            });
    }

    function reset(context, template) {
        Evergage.DisplayUtils.unbind(buildBindId(context));
        Evergage.cashDom(`[data-evg-campaign-id="${context.campaign}"][data-evg-experience-id="${context.experience}"]`)
            .remove();
    }

    function control(context) {
        const contentZoneSelector = Evergage.getContentZoneSelector(context.contentZone);
        return Evergage.DisplayUtils
            .bind(buildBindId(context))
            .pageElementLoaded(contentZoneSelector)
            .then((element) => {
                Evergage.cashDom(element).attr({
                    "data-evg-campaign-id": context.campaign,
                    "data-evg-experience-id": context.experience,
                    "data-evg-user-group": context.userGroup,
                });
            });
    }

    registerTemplate({
        apply: apply,
        reset: reset,
        control: control
    });

})();

```

</p>
</details>

<br>

<details>
<summary>Server-side TypeScript</summary>
<p>

```ts
import { SurveyReference, SurveyReferenceLookup } from "surveys";

export class SurveyTemplate implements CampaignTemplateComponent {

    @title("Survey Selector")
    @lookupOptions(() => new SurveyReferenceLookup())
    surveyReference: SurveyReference;

    run(context: CampaignComponentContext) {
        const survey = context.services.surveys.getSurvey(this.surveyReference.id);
        return {
            survey: survey
        }
    }
}

```

</p>
</details>
